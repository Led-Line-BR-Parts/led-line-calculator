<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LED LINE BR PARTS - CALCULADORA PRO</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LED LINE Pro">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#0d838c">
    <link rel="manifest" href="manifest.json">
    
    <!-- Fonts e CSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Chart.js para gráficos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    
    <!-- PDF.js para exportação PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary: #0d838c;
            --primary-dark: #0a6a71;
            --primary-light: #0fa3af;
            --secondary: #4cc9f0;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #0f172a;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --gray-dark: #334155;
            --white: #ffffff;
            --black: #000000;
            
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-xs: 4px;
            --box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --box-shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --box-shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            
            --background: #f1f5f9;
            --text: #1e293b;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --hover-bg: #f8fafc;
        }
        
        [data-theme="dark"] {
            --background: #0f172a;
            --text: #e2e8f0;
            --card-bg: #1e293b;
            --input-bg: #334155;
            --hover-bg: #334155;
            --light: #1e293b;
            --gray-light: #475569;
            --dark: #e2e8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem 0;
            position: relative;
            overflow: hidden;
            box-shadow: var(--box-shadow-lg);
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.05" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,112C960,128,1056,160,1152,160C1248,160,1344,128,1392,112L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom;
            background-size: cover;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .header-info {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        
        .header-stat {
            text-align: center;
        }
        
        .header-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .header-stat-label {
            font-size: 0.75rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Grid Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        /* Sidebar */
        .sidebar {
            position: sticky;
            top: 2rem;
            height: fit-content;
        }
        
        /* Card */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        /* Custos Categories */
        .custos-categoria {
            margin-bottom: 1.5rem;
        }
        
        .custos-categoria-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, rgba(13, 131, 140, 0.1) 0%, rgba(76, 201, 240, 0.05) 100%);
            border-radius: var(--border-radius-sm);
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .custos-categoria-header:hover {
            background: linear-gradient(135deg, rgba(13, 131, 140, 0.15) 0%, rgba(76, 201, 240, 0.1) 100%);
        }
        
        .custos-categoria-title {
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .custos-categoria-total {
            font-weight: 700;
            color: var(--primary);
        }
        
        .custos-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 0.75rem;
            border-radius: var(--border-radius-xs);
            transition: var(--transition);
        }
        
        .custos-item:hover {
            background: var(--hover-bg);
        }
        
        .custos-item-nome {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .custos-item-valor {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
        }

        .custos-item-actions {
            display: flex;
            gap: 0.25rem;
            align-items: center;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
            color: var(--text);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.625rem 0.875rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.925rem;
            background: var(--input-bg);
            color: var(--text);
            transition: var(--transition);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(13, 131, 140, 0.1);
        }
        
        .input-group {
            display: flex;
            gap: 0.5rem;
        }
        
        .input-group input {
            flex: 1;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        /* Calculadora de Parcelamento */
        .parcelamento-container {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(147, 51, 234, 0.05) 100%);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .parcelamento-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .parcelamento-grid {
            display: grid;
            gap: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .parcelamento-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--card-bg);
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--gray-light);
            transition: var(--transition);
        }

        .parcelamento-item:hover {
            border-color: var(--primary);
            box-shadow: var(--box-shadow);
        }

        .parcelamento-parcelas {
            font-weight: 600;
            color: var(--primary);
        }

        .parcelamento-valor {
            font-weight: 700;
            color: var(--text);
        }

        .parcelamento-juros {
            font-size: 0.75rem;
            color: var(--gray);
        }

        .parcelamento-total {
            font-size: 0.8125rem;
            color: var(--gray);
        }
        
        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: var(--border-radius-sm);
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--box-shadow-md);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-secondary {
            background: var(--gray-light);
            color: var(--dark);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8125rem;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-icon {
            padding: 0.5rem;
            border-radius: 50%;
        }
        
        /* Result Box */
        .result-box {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
            border: 2px solid var(--success);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .result-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--success);
        }
        
        .result-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .result-item {
            background: var(--card-bg);
            padding: 0.875rem;
            border-radius: var(--border-radius-sm);
        }
        
        .result-label {
            font-size: 0.75rem;
            color: var(--gray);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .result-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .result-highlight {
            background: var(--card-bg);
            border-radius: var(--border-radius-sm);
            padding: 1.25rem;
            text-align: center;
            margin-top: 1rem;
        }
        
        .result-highlight .result-value {
            font-size: 2rem;
            color: var(--success);
        }
        
        /* Info Alert */
        .info-alert {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
            border-left: 4px solid var(--info);
            border-radius: var(--border-radius-sm);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .info-alert-title {
            font-weight: 600;
            color: var(--info);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .info-alert-text {
            font-size: 0.875rem;
            color: var(--text);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.25rem;
            background: var(--gray-light);
            padding: 0.25rem;
            border-radius: var(--border-radius-sm);
            margin-bottom: 1.5rem;
        }
        
        .tab-button {
            flex: 1;
            padding: 0.625rem 1rem;
            background: transparent;
            border: none;
            color: var(--gray);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            border-radius: calc(var(--border-radius-sm) - 2px);
            transition: var(--transition);
        }
        
        .tab-button:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .tab-button.active {
            background: var(--white);
            color: var(--primary);
            box-shadow: var(--box-shadow);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background: var(--card-bg);
            margin: 5% auto;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            box-shadow: var(--box-shadow-lg);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }
        
        .close-modal {
            color: var(--gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        /* Theme Switch */
        .theme-switch {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 100;
            background: var(--card-bg);
            border-radius: 50px;
            padding: 0.75rem;
            box-shadow: var(--box-shadow-lg);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .theme-switch:hover {
            transform: scale(1.1);
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1.25rem;
            box-shadow: var(--box-shadow);
            border-left: 4px solid var(--primary);
        }
        
        .stat-card-title {
            font-size: 0.75rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        
        .stat-card-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-card-info {
            font-size: 0.8125rem;
            color: var(--gray);
            margin-top: 0.25rem;
        }
        
        /* Table */
        .table-responsive {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table th {
            background: var(--gray-light);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.8125rem;
            color: var(--gray-dark);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-light);
            font-size: 0.875rem;
        }
        
        .table tbody tr:hover {
            background: var(--hover-bg);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius-sm);
            box-shadow: var(--box-shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: transform 0.3s ease-out;
            z-index: 1001;
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.625rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-primary {
            background: rgba(13, 131, 140, 0.1);
            color: var(--primary);
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: relative;
                top: 0;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .header-info {
                width: 100%;
                justify-content: space-around;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .theme-switch {
                bottom: 1rem;
                right: 1rem;
            }
        }
        
        /* Loading */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.6s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Custos Toggle */
        .custos-toggle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--success);
            color: white;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .custos-toggle.inactive {
            background: var(--gray-light);
            color: var(--gray);
        }
        
        .custos-toggle:hover {
            transform: scale(1.1);
        }

        .btn-remove {
            background: transparent;
            border: none;
            color: var(--danger);
            cursor: pointer;
            padding: 0.25rem;
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .btn-remove:hover {
            transform: scale(1.2);
        }
        
        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .quick-action {
            flex: 1;
            padding: 0.5rem;
            background: var(--hover-bg);
            border: 1px solid var(--gray-light);
            border-radius: var(--border-radius-sm);
            font-size: 0.8125rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .quick-action:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .quick-action.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Theme Switch -->
    <div class="theme-switch" onclick="toggleTheme()">
        <i class="fas fa-moon" id="theme-icon"></i>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1><i class="fas fa-calculator"></i> LED LINE BR PARTS PRO</h1>
            <div class="header-info">
                <div class="header-stat">
                    <div class="header-stat-value" id="cotacao-header">R$ 5,00</div>
                    <div class="header-stat-label">Cotação USD</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value" id="custos-mensais-header">R$ 0,00</div>
                    <div class="header-stat-label">Custos Mensais</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value" id="meta-faturamento-header">R$ 0,00</div>
                    <div class="header-stat-label">Meta Faturamento</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-title">Custos Empresariais</div>
                <div class="stat-card-value" id="stat-custos-empresa">R$ 0,00</div>
                <div class="stat-card-info">Fixos + Variáveis</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">Custos Pessoais</div>
                <div class="stat-card-value" id="stat-custos-pessoais">R$ 0,00</div>
                <div class="stat-card-info">Suas despesas</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">Ponto de Equilíbrio</div>
                <div class="stat-card-value" id="stat-ponto-equilibrio">R$ 0,00</div>
                <div class="stat-card-info">Mínimo para cobrir custos</div>
            </div>
            <div class="stat-card">
                <div class="stat-card-title">Orçamentos Salvos</div>
                <div class="stat-card-value" id="stat-orcamentos">0</div>
                <div class="stat-card-info">Este mês</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Sidebar - Sistema de Custos -->
            <div class="sidebar">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-coins"></i> Central de Custos
                        </h3>
                        <button class="btn btn-sm btn-primary" onclick="abrirModalCusto()">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Custos Empresariais Fixos -->
                        <div class="custos-categoria">
                            <div class="custos-categoria-header" onclick="toggleCategoria('empresa-fixos')">
                                <div class="custos-categoria-title">
                                    <i class="fas fa-building"></i> Empresariais Fixos
                                </div>
                                <div class="custos-categoria-total" id="total-empresa-fixos">R$ 0,00</div>
                            </div>
                            <div id="custos-empresa-fixos" class="custos-lista"></div>
                        </div>

                        <!-- Custos Pessoais -->
                        <div class="custos-categoria">
                            <div class="custos-categoria-header" onclick="toggleCategoria('pessoais')">
                                <div class="custos-categoria-title">
                                    <i class="fas fa-user"></i> Pessoais
                                </div>
                                <div class="custos-categoria-total" id="total-pessoais">R$ 0,00</div>
                            </div>
                            <div id="custos-pessoais" class="custos-lista"></div>
                        </div>

                        <!-- Taxas de Pagamento -->
                        <div class="custos-categoria">
                            <div class="custos-categoria-header" onclick="toggleCategoria('pagamento')">
                                <div class="custos-categoria-title">
                                    <i class="fas fa-credit-card"></i> Taxas de Pagamento
                                </div>
                                <div class="custos-categoria-total">Por transação</div>
                            </div>
                            <div id="custos-pagamento" class="custos-lista"></div>
                        </div>

                        <!-- Impostos e Taxas -->
                        <div class="custos-categoria">
                            <div class="custos-categoria-header" onclick="toggleCategoria('impostos')">
                                <div class="custos-categoria-title">
                                    <i class="fas fa-percentage"></i> Impostos
                                </div>
                                <div class="custos-categoria-total" id="total-impostos">0%</div>
                            </div>
                            <div id="custos-impostos" class="custos-lista"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Calculadora -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-calculator"></i> Calculadora de Preços
                        </h2>
                        <button class="btn btn-sm btn-success" onclick="atualizarCotacao()">
                            <i class="fas fa-sync"></i> Atualizar USD
                        </button>
                    </div>
                    <div class="card-body">
                        <form id="calculator-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nome do Produto</label>
                                    <input type="text" id="nomeProduto" placeholder="Ex: Camiseta LED LINE" required>
                                </div>
                                <div class="form-group">
                                    <label>Custo do Produto (R$)</label>
                                    <input type="number" id="custoProduto" step="0.01" placeholder="50.00" required>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Margem de Lucro Desejada (%)</label>
                                    <input type="number" id="margemLucro" step="0.1" placeholder="40" required>
                                </div>
                                <div class="form-group">
                                    <label>Quantidade</label>
                                    <input type="number" id="quantidade" value="1" min="1" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Método de Pagamento</label>
                                <div class="quick-actions">
                                    <div class="quick-action" onclick="selecionarPagamento('pix')">
                                        <i class="fas fa-qrcode"></i> PIX
                                    </div>
                                    <div class="quick-action" onclick="selecionarPagamento('boleto')">
                                        <i class="fas fa-barcode"></i> Boleto
                                    </div>
                                    <div class="quick-action active" onclick="selecionarPagamento('cartao')">
                                        <i class="fas fa-credit-card"></i> Cartão
                                    </div>
                                    <div class="quick-action" onclick="selecionarPagamento('cartao_parcelado')">
                                        <i class="fas fa-credit-card"></i> Parcelado
                                    </div>
                                </div>
                                <input type="hidden" id="metodoPagamento" value="cartao">
                            </div>

                            <div class="form-group">
                                <label>Observações</label>
                                <textarea id="observacoes" rows="2" placeholder="Informações adicionais..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-calculator"></i> Calcular Preço de Venda
                            </button>
                        </form>

                        <!-- Resultado -->
                        <div class="result-box" id="resultado" style="display: none;">
                            <div class="result-header">
                                <div class="result-title">
                                    <i class="fas fa-check-circle"></i> Cálculo Completo
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-success" onclick="salvarOrcamento()">
                                        <i class="fas fa-save"></i> Salvar
                                    </button>
                                    <button class="btn btn-sm btn-primary" onclick="exportarPDF()">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                </div>
                            </div>

                            <div class="result-grid">
                                <div class="result-item">
                                    <div class="result-label">Custo Base</div>
                                    <div class="result-value" id="res-custo-base">R$ 0,00</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-label">Custos Operacionais</div>
                                    <div class="result-value" id="res-custos-operacionais">R$ 0,00</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-label">Taxas e Impostos</div>
                                    <div class="result-value" id="res-taxas">R$ 0,00</div>
                                </div>
                                <div class="result-item">
                                    <div class="result-label">Lucro Líquido</div>
                                    <div class="result-value" id="res-lucro">R$ 0,00</div>
                                </div>
                            </div>

                            <div class="result-highlight">
                                <div class="result-label">PREÇO DE VENDA UNITÁRIO</div>
                                <div class="result-value" id="res-preco-final">R$ 0,00</div>
                                <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--gray);">
                                    Total para <span id="res-quantidade">1</span> unidade(s): 
                                    <strong id="res-preco-total">R$ 0,00</strong>
                                </div>
                            </div>

                            <!-- Calculadora de Parcelamento -->
                            <div class="parcelamento-container" id="parcelamento-container" style="display: none;">
                                <div class="parcelamento-title">
                                    <i class="fas fa-credit-card"></i> Simulação de Parcelamento
                                </div>
                                <div class="parcelamento-grid" id="parcelamento-grid">
                                    <!-- Parcelas serão inseridas aqui -->
                                </div>
                            </div>

                            <div class="info-alert" style="margin-top: 1rem;">
                                <div class="info-alert-title">
                                    <i class="fas fa-info-circle"></i> Análise de Break-Even
                                </div>
                                <div class="info-alert-text">
                                    <div>• Você precisa vender <strong id="res-unidades-equilibrio">0</strong> unidades deste produto para cobrir todos os custos mensais</div>
                                    <div>• Ou faturar <strong id="res-faturamento-equilibrio">R$ 0,00</strong> com outros produtos</div>
                                    <div>• Margem real após todos os custos: <strong id="res-margem-real">0%</strong></div>
                                </div>
                            </div>

                            <canvas id="grafico-distribuicao" style="max-height: 300px; margin-top: 1rem;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Calculadora de Parcelamento Independente -->
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-credit-card"></i> Simulador de Parcelamento
                        </h3>
                        <span style="font-size: 0.875rem; color: var(--gray);">
                            Mostre as opções para seu cliente
                        </span>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Valor Total da Compra</label>
                                <input type="number" id="valor-parcelamento" step="0.01" placeholder="1000.00" onkeyup="calcularParcelamentoIndependente()">
                            </div>
                            <div class="form-group">
                                <label>Entrada (opcional)</label>
                                <input type="number" id="entrada-parcelamento" step="0.01" placeholder="0.00" onkeyup="calcularParcelamentoIndependente()">
                            </div>
                        </div>
                        
                        <div id="resultado-parcelamento" style="display: none;">
                            <div class="info-alert" style="margin-bottom: 1rem;">
                                <div class="info-alert-title">
                                    <i class="fas fa-info-circle"></i> Valor a Parcelar
                                </div>
                                <div class="info-alert-text">
                                    <strong id="valor-financiar">R$ 0,00</strong> (após entrada de <span id="valor-entrada-info">R$ 0,00</span>)
                                </div>
                            </div>
                            
                            <div class="parcelamento-grid" id="parcelamento-independente-grid">
                                <!-- Parcelas serão inseridas aqui -->
                            </div>
                            
                            <div style="margin-top: 1rem; padding: 1rem; background: var(--hover-bg); border-radius: var(--border-radius-sm);">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 0.875rem; color: var(--gray);">
                                        <i class="fas fa-lightbulb"></i> Dica: Ofereça 3x sem juros para aumentar conversão
                                    </span>
                                    <button class="btn btn-sm btn-primary" onclick="copiarTabelaParcelamento()">
                                        <i class="fas fa-copy"></i> Copiar Tabela
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Histórico -->
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-history"></i> Orçamentos Recentes
                        </h3>
                        <div>
                            <button class="btn btn-sm btn-secondary" onclick="exportarCSV()">
                                <i class="fas fa-file-csv"></i> CSV
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="lista-orcamentos"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Custo -->
    <div id="modal-custo" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Adicionar Custo</h3>
                <span class="close-modal" onclick="fecharModal('modal-custo')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Categoria</label>
                    <select id="custo-categoria" onchange="atualizarFormCusto()">
                        <option value="empresa-fixo">Empresarial Fixo</option>
                        <option value="pessoal">Pessoal</option>
                        <option value="pagamento">Taxa de Pagamento</option>
                        <option value="imposto">Imposto/Taxa</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="custo-nome" placeholder="Ex: Shopify">
                </div>

                <div class="form-row" id="valores-container">
                    <div class="form-group">
                        <label>Valor</label>
                        <input type="number" id="custo-valor" step="0.01" placeholder="299.00">
                    </div>
                    <div class="form-group">
                        <label>Tipo</label>
                        <select id="custo-tipo">
                            <option value="fixo">Valor Fixo (R$)</option>
                            <option value="percentual">Percentual (%)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" id="pagamento-container" style="display: none;">
                    <label>Configuração de Taxa</label>
                    <div class="form-row">
                        <div class="form-group">
                            <label style="font-size: 0.8rem;">Taxa Fixa (R$)</label>
                            <input type="number" id="custo-taxa-fixa" step="0.01" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label style="font-size: 0.8rem;">Taxa % </label>
                            <input type="number" id="custo-taxa-percentual" step="0.01" placeholder="2.99">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="fecharModal('modal-custo')">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarCusto()">
                    <i class="fas fa-save"></i> Salvar
                </button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Mensagem</span>
    </div>

    <script>
        // Estado Global
        let custos = {
            empresaFixos: [],
            pessoais: [],
            pagamento: [],
            impostos: []
        };
        let orcamentos = [];
        let cotacaoDolar = 5.00;
        let metodoPagamentoSelecionado = 'cartao';
        let chartDistribuicao = null;

        // Juros para parcelamento
        const JUROS_PARCELAMENTO = {
            1: 0,
            2: 4.96,
            3: 6.65,
            4: 8.36,
            5: 10.10,
            6: 11.84,
            7: 13.61,
            8: 15.36,
            9: 17.18,
            10: 19.00,
            11: 20.78,
            12: 22.64
        };

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            inicializar();
        });

        function inicializar() {
            carregarDados();
            configurarEventos();
            atualizarCotacao();
            
            // Se não há dados salvos, adiciona custos padrão
            if (!localStorage.getItem('ledLinePro_custos')) {
                adicionarCustosPadrao();
            }
            
            atualizarInterface();
            verificarTema();
        }

        function configurarEventos() {
            document.getElementById('calculator-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calcularPreco();
            });
        }

        function adicionarCustosPadrao() {
            // Custos Empresariais Fixos
            custos.empresaFixos = [
                { id: Date.now() + 1, nome: 'Contabilidade', valor: 350, tipo: 'fixo', ativo: true },
                { id: Date.now() + 2, nome: 'Shopify', valor: 130, tipo: 'fixo', ativo: true },
                { id: Date.now() + 3, nome: 'TCS Spy', valor: 80, tipo: 'fixo', ativo: true },
                { id: Date.now() + 4, nome: 'Linktree', valor: 29, tipo: 'fixo', ativo: true },
                { id: Date.now() + 5, nome: 'Symmprosys', valor: 29, tipo: 'fixo', ativo: true },
                { id: Date.now() + 6, nome: 'Marketing', valor: 1000, tipo: 'fixo', ativo: true }
            ];
            
            // Custos Pessoais
            custos.pessoais = [
                { id: Date.now() + 7, nome: 'Faculdade', valor: 400, tipo: 'fixo', ativo: true },
                { id: Date.now() + 8, nome: 'Luz', valor: 150, tipo: 'fixo', ativo: true },
                { id: Date.now() + 9, nome: 'Internet', valor: 100, tipo: 'fixo', ativo: true },
                { id: Date.now() + 10, nome: 'Aluguel', valor: 500, tipo: 'fixo', ativo: true },
                { id: Date.now() + 11, nome: 'Gasolina', valor: 500, tipo: 'fixo', ativo: true },
                { id: Date.now() + 12, nome: 'Lanches', valor: 300, tipo: 'fixo', ativo: true },
                { id: Date.now() + 13, nome: 'Seguro Carro', valor: 250, tipo: 'fixo', ativo: true },
                { id: Date.now() + 14, nome: 'Plano Internet Celular', valor: 120, tipo: 'fixo', ativo: true },
                { id: Date.now() + 15, nome: 'YouTube Premium', valor: 69, tipo: 'fixo', ativo: true }
            ];
            
            // Taxas de Pagamento
            custos.pagamento = [
                { id: Date.now() + 16, nome: 'PIX', metodo: 'pix', taxaFixa: 0.99, taxaPercentual: 0.99, ativo: true },
                { id: Date.now() + 17, nome: 'Boleto', metodo: 'boleto', taxaFixa: 4.48, taxaPercentual: 0, ativo: true },
                { id: Date.now() + 18, nome: 'Cartão (Vista)', metodo: 'cartao', taxaFixa: 0.99, taxaPercentual: 5.59, ativo: true },
                { id: Date.now() + 19, nome: 'Cartão (Parcelado)', metodo: 'cartao_parcelado', taxaFixa: 0.99, taxaPercentual: 5.59, ativo: true }
            ];
            
            // Impostos
            custos.impostos = [
                { id: Date.now() + 20, nome: 'Imposto CNPJ', valor: 6, tipo: 'percentual', ativo: true },
                { id: Date.now() + 21, nome: 'Checkout Yampi', valor: 1.4, tipo: 'percentual', ativo: true }
            ];
            
            salvarDados();
        }

        function atualizarInterface() {
            atualizarListaCustos();
            atualizarStats();
            atualizarListaOrcamentos();
        }

        function atualizarListaCustos() {
            // Empresa Fixos
            const containerEmpresaFixos = document.getElementById('custos-empresa-fixos');
            let totalEmpresaFixos = 0;
            
            let html = '';
            custos.empresaFixos.forEach(custo => {
                if (custo.ativo) totalEmpresaFixos += custo.valor;
                html += `
                    <div class="custos-item">
                        <div class="custos-item-nome">
                            <span class="custos-toggle ${custo.ativo ? '' : 'inactive'}" onclick="toggleCusto('empresaFixos', ${custo.id})">
                                <i class="fas fa-${custo.ativo ? 'check' : 'times'}"></i>
                            </span>
                            ${custo.nome}
                        </div>
                        <div class="custos-item-actions">
                            <span class="custos-item-valor">${formatarMoeda(custo.valor)}</span>
                            <button class="btn-remove" onclick="removerCusto('empresaFixos', ${custo.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            containerEmpresaFixos.innerHTML = html;
            document.getElementById('total-empresa-fixos').textContent = formatarMoeda(totalEmpresaFixos);
            
            // Pessoais
            const containerPessoais = document.getElementById('custos-pessoais');
            let totalPessoais = 0;
            
            html = '';
            custos.pessoais.forEach(custo => {
                if (custo.ativo) totalPessoais += custo.valor;
                html += `
                    <div class="custos-item">
                        <div class="custos-item-nome">
                            <span class="custos-toggle ${custo.ativo ? '' : 'inactive'}" onclick="toggleCusto('pessoais', ${custo.id})">
                                <i class="fas fa-${custo.ativo ? 'check' : 'times'}"></i>
                            </span>
                            ${custo.nome}
                        </div>
                        <div class="custos-item-actions">
                            <span class="custos-item-valor">${formatarMoeda(custo.valor)}</span>
                            <button class="btn-remove" onclick="removerCusto('pessoais', ${custo.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            containerPessoais.innerHTML = html;
            document.getElementById('total-pessoais').textContent = formatarMoeda(totalPessoais);
            
            // Pagamento
            const containerPagamento = document.getElementById('custos-pagamento');
            html = '';
            custos.pagamento.forEach(taxa => {
                html += `
                    <div class="custos-item">
                        <div class="custos-item-nome">
                            <span class="custos-toggle ${taxa.ativo ? '' : 'inactive'}" onclick="toggleCusto('pagamento', ${taxa.id})">
                                <i class="fas fa-${taxa.ativo ? 'check' : 'times'}"></i>
                            </span>
                            ${taxa.nome}
                        </div>
                        <div class="custos-item-actions">
                            <span class="custos-item-valor">
                                ${taxa.taxaFixa > 0 ? `R$ ${taxa.taxaFixa.toFixed(2)}` : ''} 
                                ${taxa.taxaPercentual > 0 ? `${taxa.taxaPercentual.toFixed(2)}%` : ''}
                            </span>
                            <button class="btn-remove" onclick="removerCusto('pagamento', ${taxa.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            containerPagamento.innerHTML = html;
            
            // Impostos
            const containerImpostos = document.getElementById('custos-impostos');
            let totalImpostos = 0;
            
            html = '';
            custos.impostos.forEach(imposto => {
                if (imposto.ativo && imposto.tipo === 'percentual') totalImpostos += imposto.valor;
                html += `
                    <div class="custos-item">
                        <div class="custos-item-nome">
                            <span class="custos-toggle ${imposto.ativo ? '' : 'inactive'}" onclick="toggleCusto('impostos', ${imposto.id})">
                                <i class="fas fa-${imposto.ativo ? 'check' : 'times'}"></i>
                            </span>
                            ${imposto.nome}
                        </div>
                        <div class="custos-item-actions">
                            <span class="custos-item-valor">
                                ${imposto.tipo === 'percentual' ? imposto.valor.toFixed(2) + '%' : formatarMoeda(imposto.valor)}
                            </span>
                            <button class="btn-remove" onclick="removerCusto('impostos', ${imposto.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            containerImpostos.innerHTML = html;
            document.getElementById('total-impostos').textContent = totalImpostos.toFixed(2) + '%';
        }

        function atualizarStats() {
            // Calcular totais
            let totalEmpresa = 0;
            let totalPessoais = 0;
            
            custos.empresaFixos.filter(c => c.ativo).forEach(c => totalEmpresa += c.valor);
            custos.pessoais.filter(c => c.ativo).forEach(c => totalPessoais += c.valor);
            
            const totalMensal = totalEmpresa + totalPessoais;
            const pontoEquilibrio = totalMensal * 1.3; // 30% margem média
            
            // Atualizar interface
            document.getElementById('stat-custos-empresa').textContent = formatarMoeda(totalEmpresa);
            document.getElementById('stat-custos-pessoais').textContent = formatarMoeda(totalPessoais);
            document.getElementById('stat-ponto-equilibrio').textContent = formatarMoeda(pontoEquilibrio);
            document.getElementById('stat-orcamentos').textContent = orcamentos.length;
            
            // Atualizar header
            document.getElementById('custos-mensais-header').textContent = formatarMoeda(totalMensal);
            document.getElementById('meta-faturamento-header').textContent = formatarMoeda(pontoEquilibrio);
        }

        function calcularPreco() {
            // Obter valores
            const nomeProduto = document.getElementById('nomeProduto').value;
            const custoProduto = parseFloat(document.getElementById('custoProduto').value);
            const margemLucro = parseFloat(document.getElementById('margemLucro').value);
            const quantidade = parseInt(document.getElementById('quantidade').value);
            
            // Calcular custos operacionais (distribuição proporcional)
            const custosTotaisMensais = calcularCustosTotaisMensais();
            const custoOperacionalPorProduto = custosTotaisMensais / 100; // Assumindo média de 100 produtos/mês
            
            // Calcular taxas do método de pagamento
            const taxasPagamento = calcularTaxasPagamento(metodoPagamentoSelecionado, custoProduto);
            
            // Calcular impostos
            const impostos = calcularImpostos();
            
            // Cálculo do preço
            const custoTotal = custoProduto + custoOperacionalPorProduto;
            const precoComMargem = custoTotal * (1 + margemLucro / 100);
            
            // Aplicar taxas e impostos
            const totalTaxasPercentuais = taxasPagamento.percentual + impostos.percentual;
            const precoFinal = (precoComMargem + taxasPagamento.fixo) / (1 - totalTaxasPercentuais / 100);
            
            // Adicionar juros se for parcelado
            let precoComJuros = precoFinal;
            if (metodoPagamentoSelecionado === 'cartao_parcelado') {
                // Usar juros de 12x como referência para o cálculo base
                const jurosMedio = JUROS_PARCELAMENTO[12] / 100;
                precoComJuros = precoFinal * (1 + jurosMedio);
            }
            
            // Calcular lucro líquido
            const valorTaxas = (precoComJuros * totalTaxasPercentuais / 100) + taxasPagamento.fixo;
            const lucroLiquido = precoComJuros - custoTotal - valorTaxas;
            const margemReal = (lucroLiquido / precoComJuros) * 100;
            
            // Calcular break-even
            const unidadesEquilibrio = Math.ceil(custosTotaisMensais / lucroLiquido);
            const faturamentoEquilibrio = custosTotaisMensais * (precoComJuros / lucroLiquido);
            
            // Atualizar interface
            document.getElementById('res-custo-base').textContent = formatarMoeda(custoProduto);
            document.getElementById('res-custos-operacionais').textContent = formatarMoeda(custoOperacionalPorProduto);
            document.getElementById('res-taxas').textContent = formatarMoeda(valorTaxas);
            document.getElementById('res-lucro').textContent = formatarMoeda(lucroLiquido);
            document.getElementById('res-preco-final').textContent = formatarMoeda(precoComJuros);
            document.getElementById('res-quantidade').textContent = quantidade;
            document.getElementById('res-preco-total').textContent = formatarMoeda(precoComJuros * quantidade);
            
            document.getElementById('res-unidades-equilibrio').textContent = unidadesEquilibrio;
            document.getElementById('res-faturamento-equilibrio').textContent = formatarMoeda(faturamentoEquilibrio);
            document.getElementById('res-margem-real').textContent = margemReal.toFixed(1) + '%';
            
            // Mostrar resultado
            document.getElementById('resultado').style.display = 'block';
            
            // Mostrar parcelamento APENAS se for parcelado
            if (metodoPagamentoSelecionado === 'cartao_parcelado') {
                calcularParcelamento(precoFinal * quantidade);
                document.getElementById('parcelamento-container').style.display = 'block';
            } else {
                document.getElementById('parcelamento-container').style.display = 'none';
            }
            
            // Atualizar gráfico
            atualizarGrafico({
                custoProduto,
                custoOperacionalPorProduto,
                valorTaxas,
                lucroLiquido
            });
            
            // Armazenar cálculo atual
            window.calculoAtual = {
                nomeProduto,
                custoProduto,
                margemLucro,
                quantidade,
                metodoPagamento: metodoPagamentoSelecionado,
                precoFinal: precoComJuros,
                lucroLiquido,
                margemReal,
                unidadesEquilibrio,
                observacoes: document.getElementById('observacoes').value
            };
        }

        function calcularParcelamento(valorTotal) {
            const container = document.getElementById('parcelamento-grid');
            let html = '';
            
            for (let parcelas = 1; parcelas <= 12; parcelas++) {
                const juros = JUROS_PARCELAMENTO[parcelas] / 100;
                const valorComJuros = valorTotal * (1 + juros);
                const valorParcela = valorComJuros / parcelas;
                
                const jurosText = parcelas === 1 ? '(Sem juros)' : `(${JUROS_PARCELAMENTO[parcelas]}%)`;
                
                html += `
                    <div class="parcelamento-item">
                        <div>
                            <div class="parcelamento-parcelas">${parcelas}x ${parcelas === 1 ? 'à vista' : ''}</div>
                            <div class="parcelamento-juros">${jurosText}</div>
                        </div>
                        <div>
                            <div class="parcelamento-valor">${formatarMoeda(valorParcela)}</div>
                            <div class="parcelamento-total">Total: ${formatarMoeda(valorComJuros)}</div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function calcularCustosTotaisMensais() {
            let total = 0;
            
            custos.empresaFixos.filter(c => c.ativo).forEach(c => total += c.valor);
            custos.pessoais.filter(c => c.ativo).forEach(c => total += c.valor);
            
            return total;
        }

        function calcularTaxasPagamento(metodo, valor) {
            let taxa = custos.pagamento.find(t => t.metodo === metodo && t.ativo);
            
            if (!taxa) {
                // Fallback para cartão padrão
                taxa = custos.pagamento.find(t => t.metodo === 'cartao' && t.ativo);
            }
            
            return {
                fixo: taxa ? taxa.taxaFixa : 0,
                percentual: taxa ? taxa.taxaPercentual : 0
            };
        }

        function calcularImpostos() {
            let percentualTotal = 0;
            let fixoTotal = 0;
            
            custos.impostos.filter(i => i.ativo).forEach(imposto => {
                if (imposto.tipo === 'percentual') {
                    percentualTotal += imposto.valor;
                } else {
                    fixoTotal += imposto.valor;
                }
            });
            
            return { percentual: percentualTotal, fixo: fixoTotal };
        }

        function atualizarGrafico(dados) {
            const ctx = document.getElementById('grafico-distribuicao').getContext('2d');
            
            if (chartDistribuicao) {
                chartDistribuicao.destroy();
            }
            
            chartDistribuicao = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Custo Produto', 'Custos Operacionais', 'Taxas e Impostos', 'Lucro Líquido'],
                    datasets: [{
                        data: [
                            dados.custoProduto,
                            dados.custoOperacionalPorProduto,
                            dados.valorTaxas,
                            dados.lucroLiquido
                        ],
                        backgroundColor: [
                            '#94a3b8',
                            '#f59e0b',
                            '#ef4444',
                            '#10b981'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        function selecionarPagamento(metodo) {
            metodoPagamentoSelecionado = metodo;
            document.getElementById('metodoPagamento').value = metodo;
            
            // Atualizar visual
            document.querySelectorAll('.quick-action').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.quick-action').classList.add('active');
        }

        function toggleCusto(categoria, id) {
            const lista = categoria === 'empresaFixos' ? custos.empresaFixos :
                         categoria === 'pessoais' ? custos.pessoais :
                         categoria === 'pagamento' ? custos.pagamento :
                         custos.impostos;
            
            const custo = lista.find(c => c.id === id);
            if (custo) {
                custo.ativo = !custo.ativo;
                salvarDados();
                atualizarInterface();
            }
        }

        function calcularParcelamentoIndependente() {
            const valorTotal = parseFloat(document.getElementById('valor-parcelamento').value) || 0;
            const entrada = parseFloat(document.getElementById('entrada-parcelamento').value) || 0;
            
            if (valorTotal <= 0) {
                document.getElementById('resultado-parcelamento').style.display = 'none';
                return;
            }
            
            const valorFinanciar = valorTotal - entrada;
            
            // Atualizar informações
            document.getElementById('valor-financiar').textContent = formatarMoeda(valorFinanciar);
            document.getElementById('valor-entrada-info').textContent = formatarMoeda(entrada);
            
            // Calcular parcelas
            const container = document.getElementById('parcelamento-independente-grid');
            let html = '';
            
            for (let parcelas = 1; parcelas <= 12; parcelas++) {
                const juros = JUROS_PARCELAMENTO[parcelas] / 100;
                const valorComJuros = valorFinanciar * (1 + juros);
                const valorParcela = valorComJuros / parcelas;
                
                const jurosText = parcelas === 1 ? '(Sem juros)' : `(${JUROS_PARCELAMENTO[parcelas]}% a.m.)`;
                const economia = parcelas <= 3 ? '<span style="color: var(--success); font-weight: 600;"> ⭐ Sem juros</span>' : '';
                
                html += `
                    <div class="parcelamento-item" style="${parcelas <= 3 ? 'border-color: var(--success);' : ''}">
                        <div>
                            <div class="parcelamento-parcelas">${parcelas}x ${parcelas === 1 ? 'à vista' : ''}</div>
                            <div class="parcelamento-juros">${jurosText} ${economia}</div>
                        </div>
                        <div>
                            <div class="parcelamento-valor">${formatarMoeda(valorParcela)}</div>
                            <div class="parcelamento-total">Total: ${formatarMoeda(valorComJuros)}</div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            document.getElementById('resultado-parcelamento').style.display = 'block';
        }

        function copiarTabelaParcelamento() {
            const valorTotal = parseFloat(document.getElementById('valor-parcelamento').value) || 0;
            const entrada = parseFloat(document.getElementById('entrada-parcelamento').value) || 0;
            const valorFinanciar = valorTotal - entrada;
            
            let texto = `💳 OPÇÕES DE PARCELAMENTO - LED LINE BR PARTS\n\n`;
            texto += `Valor Total: ${formatarMoeda(valorTotal)}\n`;
            if (entrada > 0) {
                texto += `Entrada: ${formatarMoeda(entrada)}\n`;
                texto += `Valor Financiado: ${formatarMoeda(valorFinanciar)}\n`;
            }
            texto += `\n📋 TABELA DE PARCELAMENTO:\n\n`;
            
            for (let parcelas = 1; parcelas <= 12; parcelas++) {
                const juros = JUROS_PARCELAMENTO[parcelas] / 100;
                const valorComJuros = valorFinanciar * (1 + juros);
                const valorParcela = valorComJuros / parcelas;
                
                if (parcelas <= 3) {
                    texto += `⭐ ${parcelas}x de ${formatarMoeda(valorParcela)} SEM JUROS\n`;
                } else {
                    texto += `${parcelas}x de ${formatarMoeda(valorParcela)} (Total: ${formatarMoeda(valorComJuros)})\n`;
                }
            }
            
            texto += `\n✅ Aceitamos PIX, Boleto e Cartão\n`;
            texto += `📦 Envio imediato após confirmação do pagamento`;
            
            // Copiar para clipboard
            navigator.clipboard.writeText(texto).then(() => {
                mostrarNotificacao('Tabela copiada! Cole no WhatsApp para o cliente.');
            }).catch(() => {
                mostrarNotificacao('Erro ao copiar. Tente novamente.', 'error');
            });
        }

        function removerCusto(categoria, id) {
            if (confirm('Deseja remover este custo?')) {
                if (categoria === 'empresaFixos') {
                    custos.empresaFixos = custos.empresaFixos.filter(c => c.id !== id);
                } else if (categoria === 'pessoais') {
                    custos.pessoais = custos.pessoais.filter(c => c.id !== id);
                } else if (categoria === 'pagamento') {
                    custos.pagamento = custos.pagamento.filter(c => c.id !== id);
                } else if (categoria === 'impostos') {
                    custos.impostos = custos.impostos.filter(c => c.id !== id);
                }
                
                salvarDados();
                atualizarInterface();
                mostrarNotificacao('Custo removido!');
            }
        }

        function abrirModalCusto() {
            document.getElementById('modal-custo').style.display = 'block';
            // Limpar campos
            document.getElementById('custo-nome').value = '';
            document.getElementById('custo-valor').value = '';
            document.getElementById('custo-categoria').value = 'empresa-fixo';
            atualizarFormCusto();
        }

        function atualizarFormCusto() {
            const categoria = document.getElementById('custo-categoria').value;
            const valoresContainer = document.getElementById('valores-container');
            const pagamentoContainer = document.getElementById('pagamento-container');
            
            if (categoria === 'pagamento') {
                valoresContainer.style.display = 'none';
                pagamentoContainer.style.display = 'block';
            } else {
                valoresContainer.style.display = 'grid';
                pagamentoContainer.style.display = 'none';
            }
        }

        function salvarCusto() {
            const categoria = document.getElementById('custo-categoria').value;
            const nome = document.getElementById('custo-nome').value;
            
            if (!nome) {
                mostrarNotificacao('Preencha o nome do custo', 'error');
                return;
            }
            
            const novoCusto = {
                id: Date.now(),
                nome: nome,
                ativo: true
            };
            
            if (categoria === 'pagamento') {
                novoCusto.metodo = nome.toLowerCase().replace(' ', '_');
                novoCusto.taxaFixa = parseFloat(document.getElementById('custo-taxa-fixa').value) || 0;
                novoCusto.taxaPercentual = parseFloat(document.getElementById('custo-taxa-percentual').value) || 0;
                custos.pagamento.push(novoCusto);
            } else {
                novoCusto.valor = parseFloat(document.getElementById('custo-valor').value) || 0;
                novoCusto.tipo = document.getElementById('custo-tipo').value;
                
                if (categoria === 'empresa-fixo') {
                    custos.empresaFixos.push(novoCusto);
                } else if (categoria === 'pessoal') {
                    custos.pessoais.push(novoCusto);
                } else if (categoria === 'imposto') {
                    custos.impostos.push(novoCusto);
                }
            }
            
            salvarDados();
            atualizarInterface();
            fecharModal('modal-custo');
            mostrarNotificacao('Custo adicionado com sucesso!');
        }

        function salvarOrcamento() {
            if (!window.calculoAtual) {
                mostrarNotificacao('Calcule o preço primeiro!', 'error');
                return;
            }
            
            const orcamento = {
                ...window.calculoAtual,
                id: Date.now(),
                data: new Date().toISOString()
            };
            
            orcamentos.unshift(orcamento);
            salvarDados();
            atualizarListaOrcamentos();
            atualizarStats();
            
            mostrarNotificacao('Orçamento salvo com sucesso!');
            
            // Limpar formulário
            document.getElementById('calculator-form').reset();
            document.getElementById('resultado').style.display = 'none';
        }

        function atualizarListaOrcamentos() {
            const container = document.getElementById('lista-orcamentos');
            
            if (orcamentos.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray);">Nenhum orçamento salvo ainda.</p>';
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table"><thead><tr>';
            html += '<th>Produto</th><th>Custo</th><th>Preço</th><th>Lucro</th><th>Margem</th><th>Ações</th>';
            html += '</tr></thead><tbody>';
            
            orcamentos.slice(0, 10).forEach(orc => {
                html += `
                    <tr>
                        <td>${orc.nomeProduto}</td>
                        <td>${formatarMoeda(orc.custoProduto)}</td>
                        <td>${formatarMoeda(orc.precoFinal)}</td>
                        <td>${formatarMoeda(orc.lucroLiquido)}</td>
                        <td>${orc.margemReal.toFixed(1)}%</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="excluirOrcamento(${orc.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function excluirOrcamento(id) {
            if (confirm('Excluir este orçamento?')) {
                orcamentos = orcamentos.filter(o => o.id !== id);
                salvarDados();
                atualizarListaOrcamentos();
                atualizarStats();
                mostrarNotificacao('Orçamento excluído!');
            }
        }

        async function atualizarCotacao() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                
                if (data && data.rates && data.rates.BRL) {
                    cotacaoDolar = data.rates.BRL;
                    document.getElementById('cotacao-header').textContent = formatarMoeda(cotacaoDolar);
                    mostrarNotificacao('Cotação atualizada!');
                }
            } catch (error) {
                console.error('Erro ao atualizar cotação:', error);
                document.getElementById('cotacao-header').textContent = formatarMoeda(5.00);
            }
        }

        function exportarPDF() {
            if (!window.calculoAtual) {
                mostrarNotificacao('Calcule o preço primeiro!', 'error');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.setTextColor(13, 131, 140);
            doc.text('LED LINE BR PARTS', 105, 20, { align: 'center' });
            
            doc.setFontSize(14);
            doc.setTextColor(0);
            doc.text('Orçamento Profissional', 105, 30, { align: 'center' });
            
            // Content
            doc.setFontSize(12);
            let y = 50;
            
            doc.text(`Produto: ${window.calculoAtual.nomeProduto}`, 20, y);
            y += 10;
            doc.text(`Data: ${new Date().toLocaleDateString('pt-BR')}`, 20, y);
            y += 15;
            
            doc.text(`Custo: ${formatarMoeda(window.calculoAtual.custoProduto)}`, 20, y);
            y += 10;
            doc.text(`Margem: ${window.calculoAtual.margemLucro}%`, 20, y);
            y += 10;
            doc.text(`Quantidade: ${window.calculoAtual.quantidade}`, 20, y);
            y += 15;
            
            doc.setFontSize(14);
            doc.setTextColor(13, 131, 140);
            doc.text(`Preço Unitário: ${formatarMoeda(window.calculoAtual.precoFinal)}`, 20, y);
            y += 10;
            doc.text(`Preço Total: ${formatarMoeda(window.calculoAtual.precoFinal * window.calculoAtual.quantidade)}`, 20, y);
            y += 15;
            
            doc.setFontSize(10);
            doc.setTextColor(100);
            doc.text(`Unidades para equilibrio: ${window.calculoAtual.unidadesEquilibrio}`, 20, y);
            
            doc.save(`orcamento_${window.calculoAtual.nomeProduto}.pdf`);
            mostrarNotificacao('PDF exportado!');
        }

        function exportarCSV() {
            if (orcamentos.length === 0) {
                mostrarNotificacao('Não há orçamentos para exportar', 'error');
                return;
            }
            
            let csv = 'Produto,Custo,Preço,Lucro,Margem,Quantidade\n';
            
            orcamentos.forEach(o => {
                csv += `"${o.nomeProduto}",${o.custoProduto},${o.precoFinal},${o.lucroLiquido},${o.margemReal},${o.quantidade}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'orcamentos_led_line.csv';
            link.click();
            
            mostrarNotificacao('CSV exportado!');
        }

        function fecharModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function toggleCategoria(categoria) {
            // Implementar toggle visual se necessário
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            document.getElementById('theme-icon').className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('theme', newTheme);
        }

        function verificarTema() {
            const theme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', theme);
            document.getElementById('theme-icon').className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function mostrarNotificacao(mensagem, tipo = 'success') {
            const notification = document.getElementById('notification');
            const icon = notification.querySelector('i');
            
            icon.className = tipo === 'error' ? 'fas fa-exclamation-circle' : 
                           tipo === 'warning' ? 'fas fa-exclamation-triangle' : 
                           'fas fa-check-circle';
            
            notification.className = `notification ${tipo}`;
            document.getElementById('notification-text').textContent = mensagem;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }

        function carregarDados() {
            // Carregar custos
            const dadosCustos = localStorage.getItem('ledLinePro_custos');
            if (dadosCustos) {
                custos = JSON.parse(dadosCustos);
            }
            
            // Carregar orçamentos
            const dadosOrcamentos = localStorage.getItem('ledLinePro_orcamentos');
            if (dadosOrcamentos) {
                orcamentos = JSON.parse(dadosOrcamentos);
            }
        }

        function salvarDados() {
            // Salvar custos separadamente
            localStorage.setItem('ledLinePro_custos', JSON.stringify(custos));
            
            // Salvar orçamentos separadamente
            localStorage.setItem('ledLinePro_orcamentos', JSON.stringify(orcamentos));
        }

        // Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Service Worker registrado'))
                .catch(err => console.error('Erro ao registrar Service Worker:', err));
        }
    </script>
</body>
</html>
